CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C FILE: COMPUTE CREEP OF CU-OFHC AND CUCRZR
C AUTHOR: FERNANDO OLEO BLANCO
C YEAR: 2022
C GOAL: IMPROVE THE MODELISATION OF SAID MATERIALS
C FRAMEWORK: TUM/ICAI MASTER THESIS
C CONTACT EMAIL: fernando.oleo@tum.de
C                fernando.oleo@alu.comillas.edu
C INFORMATION REGARDING SOURCES FOR THE DATA
C SHOULD BE INSIDE EACH MATERIAL'S SUBROUTINE
C
C IMPORTANT INFORMATION
C
C UNITS
C THE UNITS USED FOR THIS SUBROUTINE ASSUME AS INPUTS
C MILLIMETERS FOR UNIT LENGTH
C NEWTONS FOR FORCE
C CENTIGRADES (C) FOR TEMPERATURE
C
C NOTES
C THIS FILE USES FORTRAN IMPLICIT TYPING
C THIS MEANS THAT VARIABLES WHICH START WITH
C I, J, K, L, M, or N ARE TREATED AS INTEGERS
C AND EVERY OTHER VARIABLE IS TREATED AS A REAL
C
C THE CREEP SUBROUTINE, WHICH IS THE ONE CALLED BY
C ABAQUS, IS AT THE BOTTOM OF THIS FILE
C
C THE COMPILER USED FOR THIS FILE IS THE
C INTEL ONEAPI HPC FORTRAN COMPILER
C THE INTEL ONEAPI PLATFORM IS FREE TO USE
C IT WAS CONFIGURED AS EXPLAINED IN THIS VIDEO
C https://www.youtube.com/watch?v=WPA-V_qEt_w
C HOWEVER, THE FOLLOWING LINE WAS USED TO SET THE COMPILER'S
C SETTINGS (IN ORDER TO GAIN MORE PERFORMANCE)
C compile_fortran += ['/names:lowercase', '/QxHost', '/O3', '/fp:fast=2',]
C THE DOCUMENTATION FOR INTEL'S COMPILER OPTIONS CAN BE FOUND AT
C https://www.intel.com/content/www/us/en/develop/documentation/fortran-compiler-oneapi-dev-guide-and-reference/top/compiler-reference/compiler-options/alphabetical-list-of-compiler-options.html
C THE CHOSEN OPTIONS ARE A CLOSE APPROXIMATION TO "/fast"
C BUT SINCE "/fast" WAS GIVING ERROS, THEY WERE INDIVIDUALLY SELECTED
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C CREEP COMPUTATION FOR CU-OFHC
      SUBROUTINE CREEP_CU(DECRA,DESWA,STATEV,SERD,EC,ESW,P,QTILD,
     1 TEMP,DTEMP,PREDEF,DPRED,TIME,DTIME,CMNAME,LEXIMP,LEND,
     2 COORDS,NSTATV,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
C
      INCLUDE 'ABA_PARAM.INC'
C
      CHARACTER*80 CMNAME
C
      DIMENSION DECRA(5),DESWA(5),STATEV(*),PREDEF(*),DPRED(*),
     1 TIME(3),EC(2),ESW(2),COORDS(*)
C 
C MODEL AND PARAMETERS TAKEN FROM
C https://experts.illinois.edu/en/publications/modeling-creep-and-fatigue-of-copper-alloys
C "Modeling creep and fatigue of copper alloys"
C THE INDICATED RANGE IS FOR:
C TEMPERATURE: 400 TO 700 C
C STRESS: 15 TO 105 MPA
C
C ONLY SECONDARY CREEP RATE (ALSO KNOWN AS MINIMUM OR STEADY)
C SINCE THE AVAILABILITY OF PRIMARY CREEP IS NOT CLEAR/GOOD
C WE USE THE NORTON-BAILEY LAW
C
      A=38.8
      AN=4.8
C ACTIVATION ENERGY FOR SELF DIFUSSION IN J*MOL-1
      ENACT=197E3
C UNIVERSAL GAS CONSTANT IN J*MOL-1*K-1
      R=8.31432
C THE ARRHENIUS TERM REQUIRES THE TEMPERATURE IN ABSOLUTE TERMS, IN K
      TEMPABS = TEMP+273.15
C
C CONSTANT TERM. SCALAR, ARRHENIUS AND TIME
      CONST = A*EXP(-ENACT/(R*TEMPABS))*DTIME
C STRESS TERM
      SIGMA = QTILD**AN
C
      DECRA(1) = CONST*SIGMA
      IF(LEXIMP.EQ.1) THEN
C REUSE COMPUTED TERM
C DERIVATIVE IS CONST*AN*(QTILD**(AN-1))
C QTILD**(AN-1) .EQ. SIGMA/QTILD... BUT DO NOT USE THAT!
C SIGMA/QTILD IS INF IF QTILD IS 0, WHICH IT IS AT THE BEGINNING
C I COULD DO AN INITIAL SETUP FOR THE VARIABLE, BUT IT IS NOT WORTH IT
       DECRA(5) = CONST*AN*QTILD**(AN-1)
      END IF
C
C DEBUG INFO
C      WRITE(7,*) "CU-OFHC CREEP CALCULATION:"
C      WRITE(7,*) "DECRA(1): ", DECRA(1), " AND DECRA(5): ", DECRA(5)
C
      RETURN
      END
C
C
C
C
C CREEP COMPUTATION FOR CUCRZR
      SUBROUTINE CREEP_CUCRZR(DECRA,DESWA,STATEV,SERD,EC,ESW,P,QTILD,
     1 TEMP,DTEMP,PREDEF,DPRED,TIME,DTIME,CMNAME,LEXIMP,LEND,
     2 COORDS,NSTATV,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
C
      INCLUDE 'ABA_PARAM.INC'
C
      CHARACTER*80 CMNAME
C
      DIMENSION DECRA(5),DESWA(5),STATEV(*),PREDEF(*),DPRED(*),
     1 TIME(3),EC(2),ESW(2),COORDS(*)
C 
C       CHECK ERRORS, TEST COMPILATION AND RUN
C
C
C MODEL AND PARAMETERS TAKEN FROM
C https://experts.illinois.edu/en/publications/modeling-creep-and-fatigue-of-copper-alloys
C "Modeling creep and fatigue of copper alloys"
C THE CUCRZR ALLOY USED IS
C CU-0.65CR-0.1ZR
C THE INDICATED RANGE IS FOR:
C TEMPERATURE: 216 TO 538 C
C STRESS: 183 TO 282 MPA
C
C WE ONLY MODEL THE SECONDARY CREEEP RATE.
C SINCE THE SOURCE PROVIDES TWO MODELS FOR DIFFERENT TEMPERATURES
C WE USE THEM BOTH AND INTERPOLATE BETWEEN THEM
C
      A=4.64E-8
      AN=7.4
C ACTIVATION ENERGY FOR SELF DIFUSSION IN J*MOL-1
      ENACT=197E3
C UNIVERSAL GAS CONSTANT IN J*MOL-1*K-1
      R=8.31432
C THE ARRHENIUS TERM REQUIRES THE TEMPERATURE IN ABSOLUTE TERMS, IN K
      TEMPABS=TEMP+273.15
C
C CONSTANT TERM. SCALAR, ARRHENIUS AND TIME
      CONST = A*EXP(-ENACT/(R*TEMPABS))*DTIME
C STRESS TERM
      SIGMA = QTILD**AN
C
      DECRA(1) = CONST*SIGMA
      IF(LEXIMP.EQ.1) THEN
C REUSE COMPUTED TERM
C DERIVATIVE IS CONST*AN*(QTILD**(AN-1))
C QTILD**(AN-1) .EQ. SIGMA/QTILD
       DECRA(5) = CONST*AN*QTILD**(AN-1)
      END IF
      RETURN
      END

C
C MAIN CREEP SUBROUTINE, CALLED BY ABAQUS
C
      SUBROUTINE CREEP(DECRA,DESWA,STATEV,SERD,EC,ESW,P,QTILD,
     1 TEMP,DTEMP,PREDEF,DPRED,TIME,DTIME,CMNAME,LEXIMP,LEND,
     2 COORDS,NSTATV,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
C
      INCLUDE 'ABA_PARAM.INC'
C
      CHARACTER*80 CMNAME
C
      DIMENSION DECRA(5),DESWA(5),STATEV(*),PREDEF(*),DPRED(*),
     1 TIME(3),COORDS(*),EC(2),ESW(2)
C
C DOCUMENTATION FOR THIS SUBROUTINE CAN BE FOUND IN
C https://abaqus-docs.mit.edu/2017/English/SIMACAESUBRefMap/simasub-c-creep.htm
C
C
C MATERIAL INFORMATION
C NAMES OF THE MATERIALS CAN BE CHANGED BELOW IN THEIR DEFINITION
C
C WE BREAK UP THE CREEP SUBROUTINE INTO SEVERAL OTHERS TO ALLOW
C FOR MULTIPLE MATERIALS TO BE DEFINED
C
C SELECT MATERIAL TO COMPUTE CREEP
C
C USE "MODERN" FORTRAN 95 FEATURES
C
C DEFINE MATERIAL NAMES
C
C
      CHARACTER, PARAMETER :: CU_NAME = "ITER Cu You-harden for WPDIV phase II"
      CHARACTER, PARAMETER :: CUCRZR_NAME = "CuCrZr_ITER_A"
C
C SELECT SUBROUTINE DEPENDING ON THE MATERIAL BEING COMPUTED
C
      IF (CMNAME(1:LEN(CU_NAME)) .EQ. CU_NAME) THEN
            CALL CREEP_CU(DECRA,DESWA,STATEV,SERD,EC,ESW,P,QTILD,
     1 TEMP,DTEMP,PREDEF,DPRED,TIME,DTIME,CMNAME,LEXIMP,LEND,
     2 COORDS,NSTATV,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
C            WRITE(7,*) "CREEP SUBROUTINE: COMPUTED CU CREEP"
      ELSE IF(CMNAME(1:LEN(CUCRZR_NAME)) .EQ. CUCRZR_NAME) THEN
            CALL CREEP_CUCRZR(DECRA,DESWA,STATEV,SERD,EC,ESW,P,QTILD,
     1 TEMP,DTEMP,PREDEF,DPRED,TIME,DTIME,CMNAME,LEXIMP,LEND,
     2 COORDS,NSTATV,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
C            WRITE(7,*) "CREEP SUBROUTINE: COMPUTED CUCRZR CREEP"
      ELSE
C
C MATERIAL NOT IN THE SELECTION
C WRITE ERROR
C THE ERROR GETS PRINTED IN THE .MSG FILE
C FOR MORE INFORMATION ON THE FILE DESCRIPTOR NUMBERS USED BY
C ABAQUS, SEE
C https://abaqus-docs.mit.edu/2017/English/SIMACAEEXCRefMap/simaexc-c-unitnumbers.htm
C
            WRITE(7,*) "CREEP SUBROUTINE: MATERIAL NOT FOUND"
            WRITE(7,*) "MATERIAL NAME THAT WAS RECEIVED"
            WRITE(7,*) CNAME
            WRITE(7,*) "PLEASE, FIX THE NAME OF THE MATERIAL IN THE FORTRAN CODE"
      END IF
C
      RETURN
      END
